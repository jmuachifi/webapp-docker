trigger:
- main

resources:
- repo: self

variables:
  dockerHubServiceConnection: 'docker-hub-connection' # Replace with your Docker Hub service connection name
  imageRepository: 'jmuachifi/webappdemo' # Replace with your Docker Hub repository name
  dockerfilePath: '**/Dockerfile'
  tag: $(Build.BuildId)
  latestTag: latest

pool:
  vmImage: 'ubuntu-latest' # Replace with the actual image name instead of $(vmImageName)

stages:
- stage: Build
  displayName: Build and push stage
  jobs:
  - job: Build
    displayName: Build
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - task: Docker@2
      inputs:
        containerRegistry: $(dockerHubServiceConnection)
        repository: $(imageRepository)
        command: 'buildAndPush'
        Dockerfile: $(dockerfilePath)
        tags: |
          $(tag)
          $(latestTag)
